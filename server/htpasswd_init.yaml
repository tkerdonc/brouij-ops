---
- block:
    - name: check for existing htpasswd
      stat:
        path: "/opt/custom/htpasswd.{{ account }}"
      register: htpasswd
    - when: htpasswd.stat.exists == False
      block:
        - name: fill password value
          shell: openssl rand -base64 20
          register: htpasswd_value
        - name: create htpasswd file
          htpasswd:
            path: /opt/custom/htpasswd.{{ account }}
            name: "{{ account }}"
            password: "{{ web_password }}"
        - debug:
            msg: "{{ account }} password: {{ htpasswd_value.stdout }}"
